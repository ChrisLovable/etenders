[build]
  functions = "netlify/functions"
  publish = "web"
  command = "node scripts/generate_etender_gov_data.js && node -e \"const fs=require('fs'); fs.mkdirSync('web/data',{recursive:true}); fs.mkdirSync('web/assets',{recursive:true}); fs.copyFileSync('advertised_tenders.csv','web/data/advertised_tenders.csv'); if(fs.existsSync('etender_gov_data.csv')) fs.copyFileSync('etender_gov_data.csv','web/data/etender_gov_data.csv'); if(fs.existsSync('ai_opportunities.csv')) fs.copyFileSync('ai_opportunities.csv','web/data/ai_opportunities.csv'); ['matjhabeng_tenders.csv','mangaung_tenders.csv','nelsonmandelabay_tenders.csv','buffalocity_tenders.csv','sarahbaartman_tenders.csv','kouga_tenders.csv','amathole_tenders.csv','amahlathi_tenders.csv','drabxuma_tenders.csv','beyersnaude_tenders.csv','elundini_tenders.csv','emalahleni_tenders.csv','greatkei_tenders.csv','ingquzahill_tenders.csv','intsikayethu_tenders.csv','inxubayethemba_tenders.csv','joegqabi_tenders.csv','ksd_tenders.csv','koukamma_tenders.csv','bluecrane_tenders.csv','mhlontlo_tenders.csv','mbhashe_tenders.csv','ntabankulu_tenders.csv','senqu_tenders.csv','sakhisizwe_tenders.csv','nyandeni_tenders.csv','ortambo_tenders.csv','masilonyana_tenders.csv','mohokare_tenders.csv','moqhaka_tenders.csv','nketoana_tenders.csv','phumelela_tenders.csv','capetown_tenders.csv','westcoastdm_tenders.csv','beaufortwest_tenders.csv','bergrivier_tenders.csv','cederberg_tenders.csv','laingsburg_tenders.csv','langeberg_tenders.csv','oudtshoorn_tenders.csv','overstrand_tenders.csv','princealbert_tenders.csv','saldanhabay_tenders.csv','stellenbosch_tenders.csv','sundaysrivervalley_tenders.csv','umzimvubu_tenders.csv','swartland_tenders.csv','swellendam_tenders.csv','winniemadikizelamandela_tenders.csv'].forEach(f=>{if(fs.existsSync(f))fs.copyFileSync(f,'web/data/'+f)}); const p192=fs.existsSync('public/proper192.png')?'public/proper192.png':(fs.existsSync('public/PROPER192.png')?'public/PROPER192.png':null); const p512=fs.existsSync('public/proper512.png')?'public/proper512.png':(fs.existsSync('public/PROPER512.png')?'public/PROPER512.png':null); if(p192) fs.copyFileSync(p192,'web/assets/proper192.png'); if(p512) fs.copyFileSync(p512,'web/assets/proper512.png');\""

[functions]
  included_files = ["./advertised_tenders.csv","./ai_opportunities.csv","./lib","./municipal_scrapers.js","./scrape_municipal_matjhabeng.js","./scrape_municipal_mangaung.js","./scrape_municipal_nelsonmandelabay.js","./scrape_municipal_buffalocity.js","./scrape_municipal_sarahbaartman.js","./scrape_municipal_kouga.js","./scrape_municipal_amathole.js","./scrape_municipal_amahlathi.js","./scrape_municipal_drabxuma.js","./scrape_municipal_beyersnaude.js","./scrape_municipal_elundini.js","./scrape_municipal_emalahleni.js","./scrape_municipal_greatkei.js","./scrape_municipal_ingquzahill.js","./scrape_municipal_intsikayethu.js","./scrape_municipal_inxubayethemba.js","./scrape_municipal_joegqabi.js","./scrape_municipal_ksd.js","./scrape_municipal_koukamma.js","./scrape_municipal_bluecrane.js","./scrape_municipal_mhlontlo.js","./scrape_municipal_mbhashe.js","./scrape_municipal_ntabankulu.js","./scrape_municipal_senqu.js","./scrape_municipal_sakhisizwe.js","./scrape_municipal_nyandeni.js","./scrape_municipal_ortambo.js","./scrape_municipal_masilonyana.js","./scrape_municipal_mohokare.js","./scrape_municipal_moqhaka.js","./scrape_municipal_nketoana.js","./scrape_municipal_phumelela.js","./scrape_municipal_capetown.js","./scrape_municipal_westcoastdm.js","./scrape_municipal_beaufortwest.js","./scrape_municipal_bergrivier.js","./scrape_municipal_cederberg.js","./scrape_municipal_laingsburg.js","./scrape_municipal_langeberg.js","./scrape_municipal_oudtshoorn.js","./scrape_municipal_overstrand.js","./scrape_municipal_princealbert.js","./scrape_municipal_saldanhabay.js","./scrape_municipal_stellenbosch.js","./scrape_municipal_sundaysrivervalley.js","./scrape_municipal_umzimvubu.js","./scrape_municipal_swartland.js","./scrape_municipal_swellendam.js","./scrape_municipal_winniemadikizelamandela.js"]

# Serve static files from CDN; only proxy API and dynamic routes to the serverless function
# Use :splat to preserve path so Express can route /api/scrape/municipal etc.
[[redirects]]
  from = "/api/*"
  to = "/.netlify/functions/server/api/:splat"
  status = 200
  force = true

[[redirects]]
  from = "/tender/*"
  to = "/.netlify/functions/server"
  status = 200
  force = true

[[redirects]]
  from = "/tender-lookup"
  to = "/.netlify/functions/server"
  status = 200
  force = true

# /data/* served from CDN (web/data/) - no function needed for static CSV
