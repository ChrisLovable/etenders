[build]
  functions = "netlify/functions"
  publish = "web"
  command = "node -e \"const fs=require('fs'); fs.mkdirSync('web/data',{recursive:true}); fs.mkdirSync('web/assets',{recursive:true}); fs.copyFileSync('advertised_tenders.csv','web/data/advertised_tenders.csv'); if(fs.existsSync('ai_opportunities.csv')) fs.copyFileSync('ai_opportunities.csv','web/data/ai_opportunities.csv'); if(fs.existsSync('public/proper192.png')) fs.copyFileSync('public/proper192.png','web/assets/proper192.png'); if(fs.existsSync('public/proper512.png')) fs.copyFileSync('public/proper512.png','web/assets/proper512.png');\""

[functions]
  included_files = ["./advertised_tenders.csv", "./ai_opportunities.csv"]

# Serve static files from CDN; only proxy API and dynamic routes to the serverless function
[[redirects]]
  from = "/api/*"
  to = "/.netlify/functions/server"
  status = 200
  force = true

[[redirects]]
  from = "/tender/*"
  to = "/.netlify/functions/server"
  status = 200
  force = true

[[redirects]]
  from = "/tender-lookup"
  to = "/.netlify/functions/server"
  status = 200
  force = true

# /data/* served from CDN (web/data/) - no function needed for static CSV
